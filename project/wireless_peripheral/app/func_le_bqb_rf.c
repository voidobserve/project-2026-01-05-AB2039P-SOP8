#include "include.h"
#include "func.h"

#if FUNC_LE_BQB_RF_EN

AT(.text.func.le_bqb_rf.msg)
void func_le_bqb_rf_message(uint16_t msg)
{
    switch (msg) {
        case MSG_SYS_1S:
            //printf("MSG_SYS_1S\n");
            break;

        default:
            func_message(msg);
            break;
    }


AT(.text.func.le_bqb_rf)
void func_le_bqb_rf_sub_process(void)
{
    // le_bqb_rf_app_proc();
}

AT(.text.func.le_bqb_rf)
void func_le_bqb_rf_process(void)
{
    func_process();
    func_le_bqb_rf_sub_process();

#if SYS_PWROFF_TIME
    if(sys_cb.pwroff_delay == 0) {
        func_cb.sta = FUNC_PWROFF;
        return;
    }
#endif

#if SYS_SLEEP_EN
    if(sleep_process(ble_is_sleep)) {

    }
#endif
}

AT(.text.func.le_bqb_rf)
void func_le_bqb_rf_init(void)
{
    bsp_ble_init();
}

AT(.text.func.le_bqb_rf)
void func_le_bqb_rf_enter(void)
{
    msg_queue_clear();
    lowpwr_pwroff_auto_dis();
    ble_set_work_mode(MODE_BQB_RF_BLE);
    func_le_bqb_rf_init();
}

AT(.text.func.le_bqb_rf)
void func_le_bqb_rf_exit(void)
{
    btstack_deinit();
    lowpwr_pwroff_auto_en();
    ble_set_work_mode(MODE_NORMAL);
    func_cb.last = FUNC_LE_BQB_RF;
}

AT(.text.func.le_bqb_rf)
void func_le_bqb_rf(void)
{
    printf("%s\n", __func__);

    func_le_bqb_rf_enter();

    while (func_cb.sta == FUNC_LE_BQB_RF) {
        func_le_bqb_rf_process();
        func_le_bqb_rf_message(msg_dequeue());
    }

    func_le_bqb_rf_exit();
}

#endif //FUNC_LE_BQB_RF_EN
